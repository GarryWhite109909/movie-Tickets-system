## 当前问题与技术栈评估
- 前端 Admin：React 16.2 + Webpack 3（`admin/package.json`），依赖 Ant Design v3、React Router v3；无现代代码分割与并发特性。
- 前端 Web：React 15.4 + Webpack 1（`web/package.json`），混用 jQuery/reqwest；构建产物为单一大包，首屏加载压力大、交互卡顿。
- 后端：Koa 2 + Babel 6 + Sequelize v4 + `koa-multer`（已弃用）；静态资源通过 `koa-static-plus`，JWT 白名单包含 `/uploads`、`/avatar`（`server/middlewareRegister.js`）。
- 上传缺陷：
  - Admin 上传端点：`POST /api/upload`（字段名 `avatar`，保存至 `public/uploads/`）
  - Web 上传端点：`POST /web/up hy6666loadAvatar`（字段名 `files`，保存至 `public/avatar/`），路由名含空格易导致请求 404，字段名不一致导致前后端对不上（`server/routes/web.js:116`）。
- 典型体验问题成因：大体量单包、图片未优化、React 15/16 的旧渲染模型、老路由/状态管理、接口请求未做缓存/预取。

## 总体策略（双轨）
- 轨道A：快速稳定（1–3天）—在现有栈上修复致命缺陷与明显性能问题，确保可用。
- 轨道B：分阶段迁移（2–4周）—升级到现代技术栈，系统性改善性能、可维护性与安全性。

## 轨道A：快速稳定项
- 修复上传：
  - 统一端点为无空格的路径（如 `POST /web/uploadAvatar`），统一字段名为 `avatar`；沿用磁盘存储，继续走 `server/public` 静态目录。
  - 将 `koa-multer` 换为社区维护的 `@koa/multer`（无业务改动，仅中间件替换）。
- 前端性能快修：
  - Admin/Web 引入路由级代码分割与懒加载（按页拆包），降低首包体积。
  - 图片体积优化与压缩（构建时 `image-min`/`svgo`），启用浏览器缓存策略（长缓存 + 文件名指纹）。
  - 接口层增加请求缓存与防抖（搜索/列表），避免重复渲染；对慢接口增加骨架屏与超时重试。
- 服务端稳态：
  - 连接池与超时配置、统一错误处理中间件，日志打点关键路径。
  - 强化 CORS/限速与上传文件大小/类型校验，避免异常文件造成阻塞。

## 轨道B：技术栈迁移路线
- 后端（推荐）：NestJS + TypeScript + Prisma + MySQL
  - 优点：模块化、依赖注入、装饰器路由、统一异常处理；Prisma 对现有库可 `introspect`，迁移平滑。
  - 功能：保留现有 REST API 契约，逐步替换；文件上传用 `FileInterceptor`（本地或云存储如 OSS/S3）。
- Admin（推荐）：
  - 优点：更快的构建、并发渲染/过渡、首屏更快；按路由/组件拆包；请求层更易管理缓存与状态。
- Web（强烈推荐）：Next.js 14（App Router）+ React 18
  - SSR/SSG + RSC 提升首屏与SEO，路由与数据获取内置；`next/image` 自动优化图片；与后端通过 API 通讯。
- 通用工程：
  - Node 18+、ESM、环境变量 `.env`；ESLint + Prettier；Vitest/Jest 单测、Playwright 端到端；Docker 化与 CI。

## 数据与兼容
- 直接复用现有 `filmsdata` 库；迁移期通过网关/代理保持旧接口兼容。
- 低风险改动（上传、字段名、端点路径统一）在快修阶段完成；迁移时逐渐替换调用方。

## 里程碑与交付
- M1（快修完成）：上传可用、明显卡顿缓解、错误处理与日志完善。
- M2（后端重构）：完成核心模块与鉴权、文件上传；对齐旧接口。
- M3（Admin/Web 迁移）：完成页面迁移、代码分割、图片优化与缓存策略；上线灰度。
- 文档：启动/部署说明、接口契约、配置清单。

## 风险与取舍
- 全量重写周期更长；双轨策略可兼顾短期可用与长期维护。
- 可选择保留 Koa 并升级依赖（最低改动），或转 NestJS（最佳规范与生态）。

## 需要确认
- 是否采用“双轨”方案：先快修再迁移？
- 后端是“升级 Koa”还是“迁移 NestJS”？
- 上传存储是否需要云端（OSS/S3），还是保留本地？

请确认是否按照此方案推进，或选择仅做快速修复而暂不迁移。